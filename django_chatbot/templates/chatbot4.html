{% extends 'base.html' %}

{% block styles %}
<style>
  body, html {
    height:  100%;
    margin:  0;
    font-family: 'Roboto', sans-serif; /* Updated font family */
    background-color: #f5f5f5; /* Light background color */
    color: #333; /* Text color */
  }
  .chat-container {
    height:  100%;
    display: flex;
    flex-direction: column;
    padding:  20px; /* Added padding */
  }
  .card {
    background-color: #fff; /* White background */
    border-radius:  15px;
    margin:  20px;
    flex:  1;
    display: flex;
    flex-direction: column;
    box-shadow:  0  2px  4px rgba(0,0,0,0.1); /* Added shadow */
  }
  .card-header {
  display: flex;
  justify-content: space-between;
  align-items: flex-end; /* Aligns items to the bottom */
  background-color: #46033896; /* Card header background color */
  color: #FFFFFF; /* Card header text color */
  border-radius:  ;
  padding:  10px; /* Added padding for spacing */
}

.header-icons {
  display: flex; /* Make icons container a flex container */
  align-items: center; /* Align icons vertically in the center */
}

.header-icons i {
  margin-left:  10px;
  color: #FFFFFF; /* Icon color */
}
  .card-body {
    flex:  1;
    overflow-y: auto;
    padding:  20px; /* Added padding */
  }
  .messages-box {
    padding:  20px; /* Adjusted padding */
  }
  .message-form {
    padding:  20px;
    background-color: #f5f5f5; /* Light form background */
  }
  .message-input {
    width: calc(100% -  80px);
    border-radius:  10px;
    border:  1px solid #ddd; /* Light border */
    padding:  10px;
    background-color: #fff; /* White background */
    color: #333; /* Text color */
  }
  .btn-send {
    width:  60px;
    border-radius:  10px;
    border: none;
    background-color: #46033896; /* pink send button */
    color: #fff; /* White text */
    transition: background-color  0.3s ease; /* Transition for hover effect */
  }

  
  .btn-send:hover {
    background-color: #f5cde1; /* lighter pink on hover */
  }

  
  /* Additional styles for accessibility and responsiveness */
</style>
{% endblock %}


{% block content %}
<div class="chat-container">
  <div class="card">
    <div class="card-header">
      Chat
      <div class="header-icons">
        <i class="fas fa-share-alt"></i> <!-- Share icon -->
        <i class="fas fa-trash-alt"></i> <!-- Delete icon -->
      </div>
    </div>    
    <div class="card-body messages-box">
      <ul class="list-unstyled messages-list">
        <li class="message received">
          <div class="message-text">
            <div class="message-sender">
              <b>AI Women's Support Chatbot</b>
            </div>
            <div class="message-content">
              Welcome {{user.username}} to our Women's Support Chatbot! We're here to provide you with information, resources, and support regarding issues such as abuse, violence, legal rights, and more. Whether you have questions about your rights, need guidance on accessing support services, or simply need someone to talk to, we're here to help. Feel free to ask any questions you may have, and we'll do our best to assist you. Your safety and well-being are our top priorities.
            </div>
          </div>
        </li>
      </ul>
    </div>
  </div>

  <form class="message-form">
    {%csrf_token%}
    <div class="input-group">
      <input type="text" class="form-control message-input" placeholder="Type your message...">
      <div class="input-group-append">
        <button type="submit" class="btn btn-send">Send</button>
      </div>
    </div>
  </form>
</div>



<script>
  const messagesList = document.querySelector('.messages-list');
  const messageForm = document.querySelector('.message-form');
  const messageInput = document.querySelector('.message-input');

  messageForm.addEventListener('submit', (event) => {
    event.preventDefault();

    const message = messageInput.value.trim();
    if (message.length === 0) {
      return;
    }

    const messageItem = document.createElement('li');
    messageItem.classList.add('message', 'sent');
    messageItem.innerHTML = `
        <div class="message-text">
            <div class="message-sender">
                <b>You</b>
            </div>
            <div class="message-content">
                ${message}
            </div>
        </div>`;
    messagesList.appendChild(messageItem);

    messageInput.value = '';

    fetch('', {
      method: 'POST',
      headers: { 'Content-Type': 'application/x-www-form-urlencoded' },
      body: new URLSearchParams({
        'csrfmiddlewaretoken': document.querySelector('[name=csrfmiddlewaretoken]').value,
        'message': message
      })
    })
      .then(response => response.json())
      .then(data => {
        const response = data.response;
        const messageItem = document.createElement('li');
        messageItem.classList.add('message', 'received');
        messageItem.innerHTML = `
        <div class="message-text">
            <div class="message-sender">
              <b>AI Women's Support Chatbot</b>
            </div>
            <div class="message-content">
                ${response}
            </div>
        </div>
          `;
        messagesList.appendChild(messageItem);
      });
  });

</script>
{% endblock %}
